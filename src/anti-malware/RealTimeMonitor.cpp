#include <set>
#include <chrono>
#include <thread>
#include <filesystem>
#include "RealTimeMonitor.h"

void RealTimeMonitor::watchDirectory(const std::string& dir, std::function<void(const std::string &)> callback) {
    std::set<std::string> knownFiles;

    for (;;) {
        auto currentFiles = std::set<std::string>();
        for (const auto &entry : std::filesystem::directory_iterator(dir)) {
            currentFiles.insert(entry.path().string());
        }

        for (const auto& file : currentFiles) {
            if (!knownFiles.count(file)) {
                callback(file);
            }
        }

        knownFiles = currentFiles;
        std::this_thread::sleep_for(std::chrono::seconds(5));
    }
}