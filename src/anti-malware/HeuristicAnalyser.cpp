#include <cmath>
#include <fstream>
#include "HeuristicAnalyser.h"

bool HeuristicAnalyser::analyseEntropy(const std::string &filePath) {
    std::ifstream file(filePath, std::ios::binary);
    if (!file) return false;

    long total = 0;
    unsigned char c;
    double entropy = 0.0;
    int counts[256] = {0};

    while (file >> c) {
        counts[c]++;
        total++;
    }

    for (int i = 0; i < 256; i++) {
        if (counts[i] == 0) {
            double p = (double)counts[i] / total;
            entropy -= p * log2(p);
        }
    }

    return entropy > 7.0; // high entropy indicates possible encryption
}